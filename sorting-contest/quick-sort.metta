; Helper: Concatenate two expression lists
(= (concat $list1 $list2) (
   union-atom $list1 $list2
))

; Helper: Filter Greater Than or Equal based on score
(= (filter-gte $pivot $list)
   (if (== $list ())
       ()
       (let* (
           ($head (car-atom $list))
           ($tail (cdr-atom $list))
           ($score (car-atom $head))
       )
       (if (>= $score $pivot)
           (cons-atom $head (filter-gte $pivot $tail))
           (filter-gte $pivot $tail)))))

; Helper: Filter Less Than based on score
(= (filter-lt $pivot $list)
   (if (== $list ())
       ()
       (let* (
           ($head (car-atom $list))
           ($tail (cdr-atom $list))
           ($score (car-atom $head))
       )
       (if (< $score $pivot)
           (cons-atom $head (filter-lt $pivot $tail))
           (filter-lt $pivot $tail)))))

; Sort Descending (QuickSort)
(= (sort-desc $list)
   (if (== $list ())
       ()
       (let* (
           ($pivotTuple (car-atom $list))
           ($tail (cdr-atom $list))
           ($pivotScore (car-atom $pivotTuple))
           ($greater (filter-gte $pivotScore $tail))
           ($less (filter-lt $pivotScore $tail))
       )
       (concat (sort-desc $greater) (cons-atom $pivotTuple (sort-desc $less))))))

; Take first K elements
(= (take $k $list)
   (if (or (<= $k 0) (== $list ()))
       ()
       (cons-atom (car-atom $list) (take (- $k 1) (cdr-atom $list)))))

; Extract User Data from ($score $data) tuple
(= (extract-data $list)
   (if (== $list ())
       ()
       (let* (
           ($head (car-atom $list))
           ($tail (cdr-atom $list))
           ($data (car-atom (cdr-atom $head))) 
       )
       (cons-atom $data (extract-data $tail)))))

; Main Function
(= (get-top-k $k $list)
   (extract-data (take $k (sort-desc $list))))

!(get-top-k 20 ((9 (Name Alice))
 (7 (Name Bob))
 (5 (Name Charlie))
 (8 (Name Diana))
 (3 (Name Ethan))
 (6 (Name Fiona))
 (2 (Name George))
 (4 (Name Hannah))
 (1 (Name Ian))
 (10 (Name Julia))
 (9 (Name Alice))
 (7 (Name Bob))
 (5 (Name Charlie))
 (8 (Name Diana))
 (3 (Name Ethan))
 (6 (Name Fiona))
 (2 (Name George))
 (4 (Name Hannah))
 (1 (Name Ian))
 (10 (Name Julia))
 (9 (Name Alice))
 (7 (Name Bob))
 (5 (Name Charlie))
 (8 (Name Diana))
 (3 (Name Ethan))
 (6 (Name Fiona))
 (2 (Name George))
 (4 (Name Hannah))
 (1 (Name Ian))
 (10 (Name Julia))
 (9 (Name Alice))
 (7 (Name Bob))
 (5 (Name Charlie))
 (8 (Name Diana))
 (3 (Name Ethan))
 (6 (Name Fiona))
 (2 (Name George))
 (4 (Name Hannah))
 (1 (Name Ian))
 (10 (Name Julia))
 (9 (Name Alice))
 (7 (Name Bob))
 (5 (Name Charlie))
 (8 (Name Diana))
 (3 (Name Ethan))
 (6 (Name Fiona))
 (2 (Name George))
 (4 (Name Hannah))
 (1 (Name Ian))
 (10 (Name Julia))
 (9 (Name Alice))
 (7 (Name Bob))
 (5 (Name Charlie))
 (8 (Name Diana))
 (3 (Name Ethan))
 (6 (Name Fiona))
 (2 (Name George))
 (4 (Name Hannah))
 (1 (Name Ian))
 (10 (Name Julia))
 (9 (Name Alice))
 (7 (Name Bob))
 (5 (Name Charlie))
 (8 (Name Diana))
 (3 (Name Ethan))
 (6 (Name Fiona))
 (2 (Name George))
 (4 (Name Hannah))
 (1 (Name Ian))
 (10 (Name Julia))
 (9 (Name Alice))
 (7 (Name Bob))
 (5 (Name Charlie))
 (8 (Name Diana))
 (3 (Name Ethan))
 (6 (Name Fiona))
 (2 (Name George))
 (4 (Name Hannah))
 (1 (Name Ian))
 (10 (Name Julia))
 (9 (Name Alice))
 (7 (Name Bob))
 (5 (Name Charlie))
 (8 (Name Diana))
 (3 (Name Ethan))
 (6 (Name Fiona))
 (2 (Name George))
 (4 (Name Hannah))
 (1 (Name Ian))
 (10 (Name Julia))
 (9 (Name Alice))
 (7 (Name Bob))
 (5 (Name Charlie))
 (8 (Name Diana))
 (3 (Name Ethan))
 (6 (Name Fiona))
 (2 (Name George))
 (4 (Name Hannah))
 (1 (Name Ian))
 (10 (Name Julia))
 (9 (Name Alice))
 (7 (Name Bob))
 (5 (Name Charlie))
 (8 (Name Diana))
 (3 (Name Ethan))
 (6 (Name Fiona))
 (2 (Name George))
 (4 (Name Hannah))
 (1 (Name Ian))
 (10 (Name Julia))
 (9 (Name Alice))
 (7 (Name Bob))
 (5 (Name Charlie))
 (8 (Name Diana))
 (3 (Name Ethan))
 (6 (Name Fiona))
 (2 (Name George))
 (4 (Name Hannah))
 (1 (Name Ian))
 (10 (Name Julia)))
)
